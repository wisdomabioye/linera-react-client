#!/usr/bin/env node
const fs=require("fs"),path=require("path"),colors={reset:"[0m",green:"[32m",yellow:"[33m",red:"[31m",cyan:"[36m",gray:"[90m"};function log(e,r="reset"){console.log(`${colors[r]}${e}${colors.reset}`)}function isCI(){return!!(process.env.CI||process.env.CONTINUOUS_INTEGRATION||process.env.BUILD_NUMBER||process.env.GITHUB_ACTIONS||process.env.GITLAB_CI||process.env.CIRCLECI)}function detectFramework(){try{const e=path.join(process.cwd(),"package.json");if(!fs.existsSync(e))return"unknown";const r=JSON.parse(fs.readFileSync(e,"utf8")),o={...r.dependencies,...r.devDependencies};return o.next?"nextjs":o.vite?"vite":o["react-scripts"]?"cra":"unknown"}catch(e){return log(`Warning: Failed to detect framework: ${e.message}`,"yellow"),"unknown"}}function getPublicDir(e){return"public"}function getUserConfig(){try{const e=path.join(process.cwd(),"package.json");if(!fs.existsSync(e))return{};return JSON.parse(fs.readFileSync(e,"utf8")).lineraConfig||{}}catch(e){return{}}}function copyDir(e,r){if(!fs.existsSync(e))throw new Error(`Source directory not found: ${e}`);fs.existsSync(r)||fs.mkdirSync(r,{recursive:!0});const o=fs.readdirSync(e,{withFileTypes:!0});let n=0;for(const s of o){const o=path.join(e,s.name),t=path.join(r,s.name);s.isDirectory()?(fs.existsSync(t)||fs.mkdirSync(t,{recursive:!0}),n+=copyDir(o,t)):(fs.copyFileSync(o,t),n++)}return n}function main(){if(log("\n[Linera React SDK] Post-install setup","cyan"),log("".repeat(50),"gray"),isCI())return log("ï¿½ Skipping in CI environment","yellow"),void log("  Run manually if needed: node node_modules/@linera/react-sdk/scripts/postinstall.js","gray");const e=getUserConfig();if(!0===e.skipPostinstall)return log("ï¿½ Skipped (skipPostinstall = true in package.json)","yellow"),void log("  To copy files manually, run: node node_modules/@linera/react-sdk/scripts/postinstall.js","gray");const r=detectFramework();log(`Framework detected: ${r}`,"gray");const o=e.publicDir||getPublicDir(r),n=e.targetDir||"linera",s=path.join(__dirname,"..","node_modules","@linera","client","dist"),t=path.join(process.cwd(),o,n);log(`Source: ${path.relative(process.cwd(),s)}`,"gray"),log(`Target: ${path.relative(process.cwd(),t)}`,"gray"),log("","reset");try{if(!fs.existsSync(s))return log("ï¿½ Source files not found","yellow"),log("  This is expected if @linera/client is not yet installed","gray"),void log("  Files will be copied after @linera/client is installed","gray");log("Copying Linera assets...","cyan");log(` Successfully copied ${copyDir(s,t)} files to ${path.relative(process.cwd(),t)}`,"green"),log("","reset"),log("Next steps:","cyan"),log("  1. Ensure your bundler serves files from the public directory","gray"),log("  2. Configure required headers (see documentation)","gray"),log("","reset")}catch(e){log(" Failed to copy Linera assets","red"),log(`  Error: ${e.message}`,"gray"),log("","reset"),log("Manual copy instructions:","yellow"),log(`  1. Copy from: ${s}`,"gray"),log(`  2. Copy to: ${t}`,"gray"),log("  3. Or run: npm run linera:copy","gray"),log("","reset")}}require.main===module&&main(),module.exports={copyDir:copyDir,detectFramework:detectFramework,getPublicDir:getPublicDir};